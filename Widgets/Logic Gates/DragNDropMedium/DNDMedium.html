<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="logicstyle.css">
    <script src="kinetic-v4.3.3.min.js"></script>
    <title>Drag-n-drop Medium Example</title>
  </head>
  <body>
    <div id="container">
    </div>
    <div id = "buttonDiv">
      <button id = "check" class = "buttons" onClick="checkGates();">Check it!</button> 
      <br />
      <button id = "help" class = "buttons" onClick = "helpInfo()">Help!</button>
       <br />
      <button id = "clear" class = "buttons" onClick = "clear()">Clear!</button>
    </div>
    <script>

    function loadImages(sources, callback) {
        var images = {};
        var loadedImages = 0;
        var numImages = 0;
        // get num of sources
        for(var src in sources) {
          numImages++;
        }
        for(var src in sources) {
          images[src] = new Image();
          images[src].onload = function() {
            if(++loadedImages >= numImages) {
              callback(images);
            }
          };
          images[src].src = sources[src];
        }
      }
        
      function draw(images){
        var stage = new Kinetic.Stage({
          container: 'container',
          width: 922,
          height: 691
        });


        var layer = new Kinetic.Layer();
       
        var guideText = new Kinetic.Text({
          x: 100,
          y: 0,
          text: 'Drag and drop the logic gates into the correct\nboxes to match this statement: ',
          fontSize: 25,
          fontFamily: 'Calibri',
          fill: 'black',
          padding: 20
        });

        var statementText = new Kinetic.Text({
          x: 120,
          y: 70,
          text: '(P * Q) + (Q * ~Q) + (P * ~Q)',
          fontSize: 18,
          fontFamily: 'Calibri',
          fill: 'red',
          padding: 10
        });

        var textbox = new Kinetic.Rect({
          x: 100,
          y: 0,
          stroke: '#555',
          strokeWidth: 5,
          fill: '#ddd',
          width: 500,
          height: statementText.getHeight()+guideText.getHeight(),
          shadowColor: 'black',
          shadowBlur: 10,
          shadowOffset: [10, 10],
          shadowOpacity: 0.2,
          cornerRadius: 10
        });

       var andBox = new Kinetic.Rect({
          x: 0,
          y: 250,
          fillPatternImage: images.andImage,
          fillPatternRepeat: 'no-repeat',
          width: 100,
          height: 100,
          draggable: true,
        });

        var notBox = new Kinetic.Rect({
          x: 0,
          y: 360,
          fillPatternImage: images.notImage,
          fillPatternRepeat:'no-repeat',
          width: 100,
          height: 100,
          draggable: true,
        });

        var orBox = new Kinetic.Rect({
          x: 0,
          y: 470,
          fillPatternImage: images.orImage,
          fillPatternRepeat:'no-repeat',
          width: 100,
          height: 100,
          draggable: true,
        });
        var drop1 = new Kinetic.Rect({
          x: 190,
          y: 260,
          width: 100,
          height: 100,
          fill: '',
          stroke: 'black',
          strokeWidth: 2

        });

        var drop2 = new Kinetic.Rect({
          x: 190,
          y: 460,
          width: 100,
          height: 100,
          fill: '',
          stroke: 'black',
          strokeWidth: 2

        });
        var drop3 = new Kinetic.Rect({
          x: 370,
          y: 140,
          width: 100,
          height: 100,
          fill: '',
          stroke: 'black',
          strokeWidth: 2
        });
        
        var drop4 = new Kinetic.Rect({
          x: 370,
          y: 280,
          width: 100,
          height: 100,
          fill: '',
          stroke: 'black',
          strokeWidth: 2
        });

        var drop5 = new Kinetic.Rect({
          x: 370,
          y: 430,
          width: 100,
          height: 100,
          fill: '',
          stroke: 'black',
          strokeWidth: 2
        });


        var drop6 = new Kinetic.Rect({
          x: 550,
          y: 280,
          width: 100,
          height: 100,
          fill: '',
          stroke: 'black',
          strokeWidth: 2
        });


        var P = new Kinetic.Circle({
          x: 50,
          y: 160,
          radius: 15,
          fill: '',
          stroke: 'black',
          strokeWidth: 2,
          text: 'P',
          fontSize: 20,
          fontFamily: 'Calibri',
          textFill: 'black'
        });

        var Q = new Kinetic.Circle({
          x: 50,
          y: 220,
          radius: 15,
          fill: '',
          stroke: 'black',
          strokeWidth: 2,
          text: 'Q',
          fontSize: 20,
          fontFamily: 'Calibri',
          textFill: 'black'

        });
        var ptext=new Kinetic.Text({
          x: 44,
          y: 152,
          text: 'P',
          fontSize: 20,
          fontFamily: 'Calibri',
          fill: 'black'
        });
        var qtext = new Kinetic.Text({
          x: 43,
          y: 210,
          text: 'Q',
          fontSize: 20,
          fontFamily: 'Calibri',
          fill: 'black'
        });
        var PtoDrop3 = new Kinetic.Line({
          points: [63, 160, 370, 160],
          stroke: 'black',
          strokeWidth: 5
        });
        var PtoB = new Kinetic.Line({
          points: [115, 160, 115, 445],
          stroke: 'black',
          strokeWidth: 5
        });
        var BtoDrop4 = new Kinetic.Line({
          points: [112, 445, 370, 445],
          stroke: 'black',
          strokeWidth: 5
        });
       var QtoDrop3 = new Kinetic.Line({
          points: [63, 220, 370, 220],
          stroke: 'green',
          strokeWidth: 5
        });
        var QtoA = new Kinetic.Line({
          points: [150, 220, 150, 510],
          stroke: 'green',
          strokeWidth: 5
        });
        var AtoDrop1 = new Kinetic.Line({
          points: [147, 310, 190, 310],
          stroke: 'green',
          strokeWidth: 5
        });
        var AtoDrop2 = new Kinetic.Line({
          points: [147, 510, 190, 510],
          stroke: 'green',
          strokeWidth: 5
        });        
        var AtoDrop4 = new Kinetic.Line({
          points: [147, 370, 370, 370],
          stroke: 'green',
          strokeWidth: 5
        });
        var drop2todrop5=new Kinetic.Line({
          points: [290, 510, 370, 510],
          stroke: 'green',
          strokeWidth: 5
        });
        var drop1todrop4=new Kinetic.Line({
          points: [290, 310, 370, 310],
          stroke: 'green',
          strokeWidth: 5
        });
        var drop3todrop4=new Kinetic.Line({
          points: [470, 330, 550, 330],
          stroke: 'black',
          strokeWidth: 5
        });
        var drop3todrop61=new Kinetic.Line({
          points: [470, 190, 510, 190],
          stroke: 'black',
          strokeWidth: 5
        });
        var drop3todrop62=new Kinetic.Line({
          points: [510, 188, 510, 305],
          stroke: 'black',
          strokeWidth: 5
        });
        var drop3todrop63=new Kinetic.Line({
          points: [508, 305, 550, 305],
          stroke: 'black',
          strokeWidth: 5
        });
        var drop5todrop61=new Kinetic.Line({
          points: [470, 480, 510, 480],
          stroke: 'black',
          strokeWidth: 5
        });
        var drop5todrop62=new Kinetic.Line({
          points: [510, 482, 510, 355],
          stroke: 'black',
          strokeWidth: 5
        });
        var drop5todrop63=new Kinetic.Line({
          points: [508, 355, 550, 355],
          stroke: 'black',
          strokeWidth: 5         
        })
        var drop4toend=new Kinetic.Line({
          points: [650, 330, 705, 330],
          stroke: 'black',
          strokeWidth: 5 
        });
        var end = new Kinetic.Circle({
          x: 710,
          y: 330,
          radius: 15,
          fill: 'red',
          stroke: 'black',
          strokeWidth: 2,
        });

        layer.add(textbox);
        layer.add(statementText);
        layer.add(guideText);
        layer.add(andBox);
        layer.add(notBox);
        layer.add(orBox);
        layer.add(drop1);
        layer.add(drop2);
        layer.add(drop3);
        layer.add(drop4);
        layer.add(drop5);
        layer.add(drop6);
        layer.add(P);
        layer.add(Q);
        layer.add(ptext);
        layer.add(qtext);
        layer.add(PtoDrop3);
        layer.add(QtoDrop3);
        layer.add(PtoB);
        layer.add(BtoDrop4);
        layer.add(QtoA);
        layer.add(AtoDrop2);
        layer.add(AtoDrop1);
        layer.add(AtoDrop4);
        layer.add(drop1todrop4);
        layer.add(drop2todrop5);
        layer.add(drop3todrop4);
        layer.add(drop3todrop61);
        layer.add(drop3todrop62);
        layer.add(drop3todrop63);
        layer.add(drop5todrop61);
        layer.add(drop5todrop62);
        layer.add(drop5todrop63);
        layer.add(drop4toend);
        layer.add(end);
        stage.add(layer);   
        notBox.on("dragend", function(){
          checkDrop(notBox);
        });
        andBox.on("dragend", function(){
          checkDrop(andBox);
        });
        orBox.on("dragend", function(){
          checkDrop(orBox);
        });
      function resetXY()
      {
        notBox.setPosition(0, 360);
        andBox.setPosition(0, 250);
        orBox.setPosition(0, 470);
        layer.draw();
      }
      function checkDrop(object)
      {
        if((object.getPosition().x >= 190 && object.getPosition().x <= 290) && (object.getPosition().y >= 260 && object.getPosition().y <= 360))
        {
          doDrop(object, drop1);
        }
        else if((object.getPosition().x >= 190 && object.getPosition().x <= 290) && (object.getPosition().y >= 460 && object.getPosition().y <= 560))
        {
          doDrop(object, drop2);
        }
        else if((object.getPosition().x >= 370 && object.getPosition().x <= 470) && (object.getPosition().y >= 140 && object.getPosition().y <= 240))
        {
          doDrop(object, drop3);
        }
        else if((object.getPosition().x >= 370 && object.getPosition().x <= 470) && (object.getPosition().y >= 240 && object.getPosition().y <= 340))
        {
          doDrop(object, drop4);
        }
        else if((object.getPosition().x >= 370 && object.getPosition().x <= 470) && (object.getPosition().y >= 430 && object.getPosition().y <= 530))
        {
          doDrop(object, drop5);
        }
        else if((object.getPosition().x >= 550 && object.getPosition().x <= 650) && (object.getPosition().y >= 280 && object.getPosition().y <= 380))
        {
          doDrop(object, drop6);
        }
        else
        {
          resetXY(object);  
        }
        layer.draw()

      }

      //handles dropping T/F buttons onto dropzones
      function doDrop(object, dropZone)
      {
        var x = dropZone.getPosition().x;
        var y = dropZone.getPosition().y;
        var image = object.getFillPatternImage();
        console.log("image: " + image);
        dropZone.setFillPatternImage(image);
        dropZone.setFillPatternRepeat('no-repeat');

        resetXY();
        layer.draw();
      }
      clear.onclick=function clear(){
        drop1.setFillPatternImage("");
        drop2.setFillPatternImage("");
        drop3.setFillPatternImage("");
        drop4.setFillPatternImage("");
        drop5.setFillPatternImage("");
        drop6.setFillPatternImage("");
        resetXY();
        layer.draw();
      }
      help.onclick = function helpInfo(){
          alert("Hey there! Having trouble? \nDrag the gates you see on the left of the screen into the drop box you think it belongs in to match the statement at the top of the screen.\nTo drag, just place your finger over the gate, hold it and drag it across the screen.\nTo drop, lift your finger.");
        }
      check.onclick=function checkGates(){
        var error = 0;
        var errorList = new Array();
        if(drop1.getFillPatternImage()==null||drop2.getFillPatternImage()==null||drop3.getFillPatternImage()==null||drop4.getFillPatternImage()==null||drop5.getFillPatternImage()==null||drop6.getFillPatternImage()==null){
          errorList.push("Blank Spots - keep going!");
          error++;
        }
        else{
          //check if first two boxes are and or or.
          if(drop1.getFillPatternImage()!=images.notImage){
            errorList.push("Drop box 1 has the wrong gate! Check your work!");
            error++;
          }
          if(drop2.getFillPatternImage()!=images.notImage){
            errorList.push("Drop box 2 has the wrong gate! Check your work!");
            error++;
          }
          if(drop3.getFillPatternImage()!=images.andImage){
              errorList.push("Drop box 3 has the wrong gate! Recheck your work!");
              error++;
          }
          if(drop4.getFillPatternImage()!=images.andImage){
              errorList.push("Drop box 4 has the wrong gate! Recheck your work!");
              error++;
          }
          if(drop5.getFillPatternImage()!=images.andImage){
              errorList.push("Dropbox 5 has the wrong gate! Recheck your work!");
              error++;
          }
          if(drop6.getFillPatternImage()!=images.orImage){
              errorList.push("Drop box 6 has the wrong gate! Recheck your work!");
              error++;
          }
        }
      if(error == 0){
        alert("Congratulations! You got the perfect combination!");
      }
      else{
        var tempString = "There are errors: ";

        for(var i = 0; i < errorList.length; i++){
          tempString += "\n-" + errorList[i];
        }
        tempString +="\nTry again";
        alert(tempString);
      }

    }



      }
      var sources = {
        notImage: 'images/Not.png',
        orImage:'images/Or.png',
        andImage:'images/And.png'
      };

      loadImages(sources, function(images) {
        draw(images);
      });


    </script>
  </body>
  </html>
